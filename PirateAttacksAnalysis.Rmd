# Анализ пиратских атак на морские судна

#### Импортируем библиотеки

```{r}
library(readr)
library(ggmap)
library(ggplot2)
library(tidyr)
library(dplyr)
library(kableExtra)
library(data.table)

```

```{r}
print_df <- function(df)
{
  df |>
    kable(format = "html") |>
    kable_styling() |>
    kableExtra::scroll_box(width = "100%", height = "100%")
}
```

```{r}
df <- read.csv(
  file = "/Users/georgymilyuskhov/pirate_attacks.csv",stringsAsFactors=FALSE,fileEncoding="latin1"
)
```

### Читаем данные

```{r}
df |> head(10) |> print_df()
```

### Проверяем когда атаки чаще всего происходили

```{r}
df1<-df
df1$date<-format(as.Date(df1$date),"%Y")
```

```{r}
year_count <- df1 %>%
  group_by(year=(df1$date)) %>%
  summarise(count = n()) %>% 
arrange(desc(count))
```

```{r}
ggplot(data=year_count, aes(x=year, y=count, group=1)) +
  geom_line(color="green")+
  geom_point()+ theme(axis.text.x = element_text(angle = 90, vjust = 0.5, size = 9))
```

Нужно отметить, что здесь не учитывается рост судоходства с 1993. Заметны новые методы по борьбе с пиратами в 2010.

### Смотрим где данные атаки происходили

Рассматриваем ближайшую страну, а не исключительную экономическую зону.

```{r}
nearest_country_count <- df1%>%
  group_by(country=(df1$nearest_country)) %>%
  summarise(count = n()) %>% 
  arrange(desc(count))
nearest_country_count |> head(15) |> print_df()


plotting_data <- nearest_country_count %>% 
  mutate(rank = rank(-count), 
         country = ifelse(rank <= 9, country, 'Other'))
```

Нужно иметь ввиду количество островов в Индонезии.

```{r}
ggplot(plotting_data, aes(x="", y=count, fill=country)) +
  geom_bar(stat="identity", width=1) +
  coord_polar("y", start=0)
```

### Рассматриваем максимальную и минимальную дистанцию атак пиратов до берега.

```{r}
df[which.max(df$shore_distance),]|> print_df()
```

```{r}
df[which.min(df$shore_distance),]|> print_df()
```

### Построим гистограмму, чтобы посмотреть, как далеко от берега происходят атаки.

```{r}
intervals <- c(0, 22, 44, 66, 88, 110, 132, 154, 176, 198, 220, 242, 264, 286, 308, 330, 352, 374, 396, 418, 440, 462, 484, 506, 528, 550, 572, 594, 616, 638, 1025)
df2<-df
df2$intervals<-cut(df2$shore_distance, breaks = intervals, include.lowest = TRUE, right = FALSE)
counts <- table(df2$intervals)

ggplot(df2, aes(x = intervals)) +
geom_bar(fill = "skyblue", color = "black")+ theme(axis.text.x = element_text(angle = 90, vjust = 0.5, size = 9))


step <- 1
breaks <- seq(0, 22, by = step)
df2$intervals2 <- cut(df2$shore_distance, breaks = breaks, include.lowest = TRUE, right = FALSE)
counts2 <- table(df2$intervals2)

ggplot(data=subset(df2, !is.na(intervals2)), aes(x = intervals2)) +
geom_bar(fill = "skyblue", color = "black")+ theme(axis.text.x = element_text(angle = 90, vjust = 0.5, size = 9))

```

Заметно, что атаки происходят наиболее часто в тереториальных водах страны.

### Интерессно посмотреть, есть ли судна на которых нападали несколько раз.

```{r}
ship_name <- df %>%
  group_by(vessel_name=df1$vessel_name) %>%
  summarise(count = n())%>%
  filter(!is.na(vessel_name))|>
  arrange(desc(count))
ship_name|>head(10)|>print_df()
```

Нужно иметь ввиду, что тут есть популярные название для пароходов.

### Рассмотрим на карте где атаки происходили наиболее часто

```{r}
world <- get_stamenmap(
    bbox = c(left = -180, bottom = -57, right = 179, top = 82.1), 
    maptype = "toner",
    zoom = 3)
```

```{r}
ggmap(world) + 
  geom_point(data = df, 
             aes(x = df$longitude, y = df$latitude), 
             alpha = .4, 
             size = .2, 
             color="red")
```

### На какие типы пароходов было больше всего нападений.

```{r}
ship_type <- df|>
  group_by(vessel_type)|>
  summarise(count=n())|>
  filter(!is.na(vessel_type))|>
  arrange(desc(count))

ship_type|>head(14)|>print_df()
```

Логично, что большие пароходы не входят в топ.

### Посмотрим в каком сотоянии они находились при нападении.

```{r}
ship_status <- df|>
  group_by(vessel_status)|>
  summarise(count=n())|>
  filter(!is.na(vessel_status))|>
  arrange(desc(count))
  
ship_status|>print_df()
```

```{r}
ship_status <- df|>
  group_by(vessel_status)|>
  summarise(count=n())|>
  filter(!is.na(vessel_status))|>
  arrange(desc(count))
ship_status|>print_df()

ggplot(data=subset(df2, !is.na(vessel_status)), aes(x = vessel_status)) +
geom_bar(fill = "skyblue", color = "black")+ theme(axis.text.x = element_text(angle = 90, vjust = 0.5, size = 9))
```

Важно отметить, что это состояние парохода на момент получения данных.

```{r}
OnWay <-ship_status$count[2]+ship_status$count[4]+ship_status$count[6]+ship_status$count[10]
Staying <- ship_status$count[1]+ship_status$count[3]+ship_status$count[5]+ship_status$count[7]+ship_status$count[8]+ship_status$count[9]+ship_status$count[11]+ship_status$count[12]


dat <- data.frame(
names = c("Staying", "On Way"),
values = c(Staying, OnWay)
)

ggplot(dat, aes(x = names, y = values)) +
geom_bar(stat = "identity", width = 0.3, fill="skyblue", color = "black") +
ylab("Count of vessels") +
xlab("Status")
```

### Какого типа была атака?

```{r}
vessel_attacks <- df|>
  group_by(attack_type)|>
  summarise(count=n())|>
  filter(!is.na(attack_type))|>
  arrange(desc(count))

vessel_attacks|>print_df()
```

### Рассмотрим где пароход был наиболее часто угнан.

```{r}
df3 <- subset(df, df$attack_type == "Hijacked")
```

```{r}
ggmap(world) + 
  geom_point(data = df3, 
             aes(x = df3$longitude, y = df3$latitude), 
             alpha = .9, 
             size = .2, 
             color="red")
```

```{r}
ship_status2 <- df3|>
  group_by(vessel_status)|>
  summarise(count=n())|>
  filter(!is.na(vessel_status))|>
  arrange(desc(count))

OnWay1 <-ship_status$count[1]+ship_status$count[3]+ship_status$count[6]
Staying1 <- ship_status$count[2]+ship_status$count[4]+ship_status$count[5]+ship_status$count[7]

dat1 <- data.frame(
names = c("Staying", "On Way"),
values = c(Staying1, OnWay1)
)

ggplot(dat1, aes(x = names, y = values)) +
geom_bar(stat = "identity", width = 0.3, fill="skyblue", color = "black") +
ylab("Count of vessels") +
xlab("Status")

```
